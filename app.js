"use strict";function ajaxArrayBuffer(e){var t=new XMLHttpRequest;t.onload=function(){if(4===t.readyState&&(t.status>=200&&t.status<300||304===t.status)){var o=e.token?e.token:e.open?publicKey:localStorage.token,a=asmCrypto.AES_CBC.decrypt(t.response,o);if(console.log("AES.decrypt"),e.uint8Arr)e.success(a);else{var n=utf8ArrToStr(a);e.success(JSON.parse(n))}}},e.progress&&(t.onprogress=function(t){t.lengthComputable&&(e.progress.style.width=t.loaded===t.total?"0%":(t.loaded/t.total*100).toFixed(2)+"%")}),(null!==e.key.match("version")||"folder/list"===e.key)&&(e.key+="?v="+Date.now()),t.open("GET","http://7teaz4.com1.z0.glb.clouddn.com/"+e.key,!0),t.responseType="arraybuffer",t.send(null)}function upload(e){var t=e.token?e.token:e.open?publicKey:localStorage.token,o=asmCrypto.AES_CBC.encrypt(e.data,t);console.log("AES.encrypt");var a=new Blob([o.buffer],{type:"application/octet-stream"}),n=customForm(e,a),r=new XMLHttpRequest;e.progress&&(r.upload.onprogress=function(t){t.lengthComputable&&(e.progress.style.width=t.loaded===t.total?"0%":(t.loaded/t.total*100).toFixed(2)+"%")}),r.onload=function(){4===r.readyState&&(r.status>=200&&r.status<300||304==r.status)&&e.success()},r.open("POST","http://upload.qiniu.com",!0),r.send(n)}function customForm(e,t){var o=JSON.parse(localStorage.user),a=o.AK,n=o.SK,r={scope:bucket+":"+e.key,deadline:3600+Math.floor(Date.now()/1e3)},s=btoa(JSON.stringify(r)),i=asmCrypto.HMAC_SHA1.base64(s,n),c=new FormData;return c.append("token",a+":"+safe64(i)+":"+s),c.append("key",e.key),c.append("file",t),c}function safe64(e){return e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_")}function insertText(e,t){if(document.selection){var o=document.selection.createRange();o.text=t}else if("number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd){var a=e.selectionStart,n=e.selectionEnd,r=a,s=e.value;e.value=s.substring(0,a)+t+s.substring(n,s.length),r+=t.length,e.selectionStart=e.selectionEnd=r}else e.value+=t}function fileTypeIcons(e){switch(e){case"image/png":case"image/jpeg":case"image/vnd.microsoft.icon":return"fa fa-file-image-o";case"application/x-xz":case"application/gzip":case"application/zip":return"fa fa-file-archive-o";case"text/plain":case"text/x-markdown":return"fa fa-file-text-o";case"application/pdf":return"fa fa-file-pdf-o";case"application/msword":case"application/vnd.oasis.opendocument.text":return"fa fa-file-word-o";default:return"fa fa-file-o"}}function nDown(e,t,o,a){var n=document.getElementById(o);ajaxArrayBuffer({key:o,open:a,uint8Arr:!0,progress:n,success:function(o){var a=new Blob([o.buffer],{type:t}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s);var i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),s.dispatchEvent(i),document.body.removeChild(s),n.value=0}})}function dragStart(e){e.dataTransfer.setData("key",e.target.dataset.key)}function timeDiff(){return Date.now()+""+Math.floor(9e3*Math.random()+1e3)}function utf8ArrToStr(e){for(var t,o="",a=e.length,n=0;a>n;n++)t=e[n],o+=String.fromCharCode(t>251&&254>t&&a>n+5?1073741824*(t-252)+(e[++n]-128<<24)+(e[++n]-128<<18)+(e[++n]-128<<12)+(e[++n]-128<<6)+e[++n]-128:t>247&&252>t&&a>n+4?(t-248<<24)+(e[++n]-128<<18)+(e[++n]-128<<12)+(e[++n]-128<<6)+e[++n]-128:t>239&&248>t&&a>n+3?(t-240<<18)+(e[++n]-128<<12)+(e[++n]-128<<6)+e[++n]-128:t>223&&240>t&&a>n+2?(t-224<<12)+(e[++n]-128<<6)+e[++n]-128:t>191&&224>t&&a>n+1?(t-192<<6)+e[++n]-128:t);return o}function strToUTF8Arr(e){for(var t,o,a=e.length,n=0,r=0;a>r;r++)o=e.charCodeAt(r),n+=128>o?1:2048>o?2:65536>o?3:2097152>o?4:67108864>o?5:6;t=new Uint8Array(n);for(var s=0,i=0;n>s;i++)o=e.charCodeAt(i),128>o?t[s++]=o:2048>o?(t[s++]=192+(o>>>6),t[s++]=128+(63&o)):65536>o?(t[s++]=224+(o>>>12),t[s++]=128+(o>>>6&63),t[s++]=128+(63&o)):2097152>o?(t[s++]=240+(o>>>18),t[s++]=128+(o>>>12&63),t[s++]=128+(o>>>6&63),t[s++]=128+(63&o)):67108864>o?(t[s++]=248+(o>>>24),t[s++]=128+(o>>>18&63),t[s++]=128+(o>>>12&63),t[s++]=128+(o>>>6&63),t[s++]=128+(63&o)):(t[s++]=252+(o>>>30),t[s++]=128+(o>>>24&63),t[s++]=128+(o>>>18&63),t[s++]=128+(o>>>12&63),t[s++]=128+(o>>>6&63),t[s++]=128+(63&o));return t}var siteTitle="Structure",bucket="proc",publicKey="GmPw2qjmTsAAUsqa",open=!0,local="#/",refresh=!1,md=window.markdownit({html:!0,breaks:!0,linkify:!0}),db=new Dexie(bucket);db.version(1).stores({etc:"id, version"}),db.version(1).stores({contents:"id, arr"}),db.version(1).stores({set:"id, arr"}),db.version(1).stores({section:"id, title, content, timestamp"}),db.open();
"use strict";function Navbar(){null!==____Class0&&____Class0.apply(this,arguments)}var ____Class0=React.Component;for(var ____Class0____Key in ____Class0)____Class0.hasOwnProperty(____Class0____Key)&&(Navbar[____Class0____Key]=____Class0[____Class0____Key]);var ____SuperProtoOf____Class0=null===____Class0?null:____Class0.prototype;Navbar.prototype=Object.create(____SuperProtoOf____Class0),Navbar.prototype.constructor=Navbar,Navbar.__superConstructor__=____Class0,Object.defineProperty(Navbar.prototype,"handleIndexClick",{writable:!0,configurable:!0,value:function(e){e.preventDefault(),this.refs.mainput.getDOMNode().value="",location.href="#/"}}),Object.defineProperty(Navbar.prototype,"handleLogoutClick",{writable:!0,configurable:!0,value:function(e){e.preventDefault(),this.props.logout()}}),Object.defineProperty(Navbar.prototype,"handleLoginClick",{writable:!0,configurable:!0,value:function(e){e.preventDefault(),local=location.hash,location.href="#/login"}}),Object.defineProperty(Navbar.prototype,"handleMainputChange",{writable:!0,configurable:!0,value:function(e){e.preventDefault();var a=this.refs.mainput.getDOMNode().value;a.length>1?location.href="#/s/"+a:""===a&&(location.href="#/")}}),Object.defineProperty(Navbar.prototype,"preventDefault",{writable:!0,configurable:!0,value:function(e){e.preventDefault()}}),Object.defineProperty(Navbar.prototype,"drop",{writable:!0,configurable:!0,value:function(e){e.preventDefault();var a=e.dataTransfer.getData("key");""!==a&&this.props.erase(a)}}),Object.defineProperty(Navbar.prototype,"render",{writable:!0,configurable:!0,value:function(){var e;return e=this.props.auth?React.createElement("div",null,React.createElement("a",{className:"nav-site",href:"#/a"},React.createElement("span",{className:"fa fa-plus","aria-hidden":"true"})),React.createElement("a",{className:"nav-site",href:"#/tasks"},React.createElement("span",{className:"fa fa-tasks","aria-hidden":"true"})),React.createElement("a",{className:"nav-site",href:"#/folder"},React.createElement("span",{className:"fa fa-folder","aria-hidden":"true"})),React.createElement("div",{className:"nav-site",onDragOver:this.preventDefault,onDrop:this.drop.bind(this)},React.createElement("span",{className:"fa fa-trash-o","aria-hidden":"true"})),React.createElement("span",{className:"nav-site"}),React.createElement("a",{className:"nav-site",onClick:this.handleLogoutClick.bind(this)},React.createElement("span",{className:"fa fa-sign-out","aria-hidden":"true"}))):React.createElement("div",null,React.createElement("a",{className:"nav-site",onClick:this.handleLoginClick.bind(this)},React.createElement("span",{className:"fa fa-sign-in","aria-hidden":"true"}))),React.createElement("nav",{className:"nav-main"},React.createElement("div",{className:"wrap"},React.createElement("a",{className:"nav-site nav-title",onClick:this.handleIndexClick.bind(this)},siteTitle),React.createElement("form",{className:"nav-form left",role:"search",onSubmit:this.handleMainputChange.bind(this)},React.createElement("input",{type:"text",className:"form-control mainput",ref:"mainput",onChange:this.handleMainputChange.bind(this)})),React.createElement("div",{className:"right nav-right"},e)))}});
"use strict";function Contents(t){____Class5q.call(this,t),this.state={contents:[]}}var ____Class5q=React.Component;for(var ____Class5q____Key in ____Class5q)____Class5q.hasOwnProperty(____Class5q____Key)&&(Contents[____Class5q____Key]=____Class5q[____Class5q____Key]);var ____SuperProtoOf____Class5q=null===____Class5q?null:____Class5q.prototype;Contents.prototype=Object.create(____SuperProtoOf____Class5q),Contents.prototype.constructor=Contents,Contents.__superConstructor__=____Class5q,Object.defineProperty(Contents.prototype,"sort",{writable:!0,configurable:!0,value:function(){if(0===this.state.contents.length){var t=this.props.contents.slice(0);t.sort(this.props.auth?function(t,e){return e.timestamp-t.timestamp}:function(t,e){return t.title.localeCompare(e.title)}),this.setState({contents:t})}else clearInterval(this.interval)}}),Object.defineProperty(Contents.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){this.interval=setInterval(this.sort.bind(this),5)}}),Object.defineProperty(Contents.prototype,"componentWillUnmount",{writable:!0,configurable:!0,value:function(){clearInterval(this.interval)}}),Object.defineProperty(Contents.prototype,"render",{writable:!0,configurable:!0,value:function(){return React.createElement("div",{className:"wrap"},this.state.contents.map(function(t){return React.createElement("a",{className:"btn",key:t.id,href:"#/t/"+t.id,role:"button"},t.title)}))}});
"use strict";function Section(e){____Classh.call(this,e),this.state={section:[],keyword:""}}function Fragment(){null!==____Classi&&____Classi.apply(this,arguments)}function Attachment(){null!==____Classj&&____Classj.apply(this,arguments)}var ____Classh=React.Component;for(var ____Classh____Key in ____Classh)____Classh.hasOwnProperty(____Classh____Key)&&(Section[____Classh____Key]=____Classh[____Classh____Key]);var ____SuperProtoOf____Classh=null===____Classh?null:____Classh.prototype;Section.prototype=Object.create(____SuperProtoOf____Classh),Section.prototype.constructor=Section,Section.__superConstructor__=____Classh,Object.defineProperty(Section.prototype,"loadIMG",{writable:!0,configurable:!0,value:function(e){ajaxArrayBuffer({key:e.dataset.key,open:open,uint8Arr:!0,success:function(t){var _=new Blob([t.buffer],{type:e.dataset.type}),a=URL.createObjectURL(_),n=document.createElement("img");n.src=a,n.dataset.key=e.dataset.key,n.ondragstart=dragStart,e.replaceChild(n,e.firstElementChild),e.setAttribute("name","dec-img")}})}}),Object.defineProperty(Section.prototype,"imgEvent",{writable:!0,configurable:!0,value:function(){var e=document.getElementsByName("enc-img");console.log("a");for(var t=0;t<e.length;t++){var _=e[t].getBoundingClientRect().top;_>0&&_<window.innerHeight&&this.loadIMG(e[t])}}}),Object.defineProperty(Section.prototype,"query",{writable:!0,configurable:!0,value:function(){var e={id:"",keyword:""};if("t"===location.hash.slice(2,3)?e.id=location.hash.slice(4):e.keyword=location.hash.slice(4),""!==e.id)refresh&&(console.log("Index"),db.section.get(e.id,function(e){e&&(this.setState({section:[e]}),refresh=!1,0!==document.getElementsByName("enc-img").length?(this.imgEvent(),window.onscroll=this.imgEvent.bind(this)):window.onscroll=null)}.bind(this)));else if(""!==e.keyword&&0!==this.props.set.length){var t=e.keyword;if(t!==this.state.keyword||refresh){console.log("Query");var _=[],a=new RegExp(t,"i"),n=!0,r=!1,s=void 0;try{for(var o,l=this.props.set[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var i=o.value;(null!==i.title.match(a)||null!==i.content.match(a))&&_.push(i)}}catch(c){r=!0,s=c}finally{try{!n&&l["return"]&&l["return"]()}finally{if(r)throw s}}this.setState({section:_}),this.setState({keyword:t}),refresh=!1,0!==document.getElementsByName("enc-img").length?(this.imgEvent(),window.onscroll=this.imgEvent.bind(this)):window.onscroll=null}}}}),Object.defineProperty(Section.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){refresh=!0,this.query(),this.interval=setInterval(this.query.bind(this),200)}}),Object.defineProperty(Section.prototype,"componentWillUnmount",{writable:!0,configurable:!0,value:function(){clearInterval(this.interval)}}),Object.defineProperty(Section.prototype,"render",{writable:!0,configurable:!0,value:function(){return React.createElement("div",null,this.state.section.map(function(e){return React.createElement(Fragment,{key:e.id,data:e,auth:this.props.auth})}.bind(this)))}});var ____Classi=React.Component;for(var ____Classi____Key in ____Classi)____Classi.hasOwnProperty(____Classi____Key)&&(Fragment[____Classi____Key]=____Classi[____Classi____Key]);var ____SuperProtoOf____Classi=null===____Classi?null:____Classi.prototype;Fragment.prototype=Object.create(____SuperProtoOf____Classi),Fragment.prototype.constructor=Fragment,Fragment.__superConstructor__=____Classi,Object.defineProperty(Fragment.prototype,"render",{writable:!0,configurable:!0,value:function(){var e=this.props.data,t=React.createElement("div",null);this.props.auth&&(t=React.createElement("a",{href:"#/e/"+e.id},"编辑"));for(var _=md.render(e.content),a=_.split(/(!\[.*?,.*?,.*?,.*?\])/),n=0;n<a.length;n++)if(n%2===0)""!==a[n]&&(a[n]=React.createElement("div",{dangerouslySetInnerHTML:{__html:a[n]}}));else{var r=a[n].match(/!\[(.*?),(.*?),(.*?),(.*?)\]/);r[1].length>12&&(r[1].match(/[\u4e00-\u9fa5]/)?r[1]=r[1].substring(0,11)+"...":r[1].length>21&&(r[1]=r[1].substring(0,18)+"..."));var s={name:r[1],size:r[2],type:r[3],key:r[4]};a[n]=React.createElement(Attachment,{data:s})}return React.createElement("div",null,React.createElement("div",{className:"wrap"},React.createElement("h2",null,e.title),a,t),React.createElement("hr",null))}});var ____Classj=React.Component;for(var ____Classj____Key in ____Classj)____Classj.hasOwnProperty(____Classj____Key)&&(Attachment[____Classj____Key]=____Classj[____Classj____Key]);var ____SuperProtoOf____Classj=null===____Classj?null:____Classj.prototype;Attachment.prototype=Object.create(____SuperProtoOf____Classj),Attachment.prototype.constructor=Attachment,Attachment.__superConstructor__=____Classj,Object.defineProperty(Attachment.prototype,"download",{writable:!0,configurable:!0,value:function(e){nDown(e.name,e.type,e.key,open)}}),Object.defineProperty(Attachment.prototype,"render",{writable:!0,configurable:!0,value:function(){var e,t=this.props.data,_={display:"inline-block"};return e="image/png"===t.type||"image/jpeg"===t.type||"image/vnd.microsoft.icon"===t.type?React.createElement("div",{name:"enc-img","data-name":t.name,"data-type":t.type,"data-key":t.key},React.createElement("i",{className:"fa fa-spinner fa-pulse fa-2x"})):React.createElement("div",{className:"attachment"},React.createElement(File,{key:t.key,data:t,download:this.download.bind(this,t)})),React.createElement("div",{style:_},e)}});
"use strict";function SignIn(){null!==____Class5x&&____Class5x.apply(this,arguments)}var ____Class5x=React.Component;for(var ____Class5x____Key in ____Class5x)____Class5x.hasOwnProperty(____Class5x____Key)&&(SignIn[____Class5x____Key]=____Class5x[____Class5x____Key]);var ____SuperProtoOf____Class5x=null===____Class5x?null:____Class5x.prototype;SignIn.prototype=Object.create(____SuperProtoOf____Class5x),SignIn.prototype.constructor=SignIn,SignIn.__superConstructor__=____Class5x,Object.defineProperty(SignIn.prototype,"handleSubmit",{writable:!0,configurable:!0,value:function(e){e.preventDefault();var t=this.refs.name.getDOMNode().value,a=this.refs.passwd.getDOMNode().value;ajaxArrayBuffer({key:t,token:a,success:function(e){localStorage.token=e.user.token,localStorage.user=JSON.stringify(e.user),this.props.login(),this.refs.name.getDOMNode().value="",this.refs.passwd.getDOMNode().value=""}.bind(this)})}}),Object.defineProperty(SignIn.prototype,"render",{writable:!0,configurable:!0,value:function(){return React.createElement("div",{className:"wrap"},React.createElement("form",{onSubmit:this.handleSubmit.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputName3"},"Name"),React.createElement("input",{type:"text",className:"form-control",id:"inputName3",ref:"name"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword3"},"Password"),React.createElement("input",{type:"password",className:"form-control",id:"inputPassword3",ref:"passwd"})),React.createElement("button",{type:"submit",className:"btn"},"Sign in")))}});
"use strict";function SignUp(){null!==____Class5y&&____Class5y.apply(this,arguments)}var ____Class5y=React.Component;for(var ____Class5y____Key in ____Class5y)____Class5y.hasOwnProperty(____Class5y____Key)&&(SignUp[____Class5y____Key]=____Class5y[____Class5y____Key]);var ____SuperProtoOf____Class5y=null===____Class5y?null:____Class5y.prototype;SignUp.prototype=Object.create(____SuperProtoOf____Class5y),SignUp.prototype.constructor=SignUp,SignUp.__superConstructor__=____Class5y,Object.defineProperty(SignUp.prototype,"handleSubmit",{writable:!0,configurable:!0,value:function(e){e.preventDefault();var t=this.refs.name.getDOMNode().value,a=this.refs.passwd.getDOMNode().value,r=this.refs.token.getDOMNode().value,s=this.refs.AK.getDOMNode().value,l=this.refs.SK.getDOMNode().value,n={AK:s,SK:l,token:r};localStorage.token=r,localStorage.user=JSON.stringify(n),upload({key:t,data:strToUTF8Arr(JSON.stringify({user:n})),token:a,success:function(){console.log("Success!"),this.refs.status.getDOMNode().value="Success!"}.bind(this)})}}),Object.defineProperty(SignUp.prototype,"render",{writable:!0,configurable:!0,value:function(){return React.createElement("div",{className:"wrap"},React.createElement("form",{onSubmit:this.handleSubmit.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputName3"},"Name"),React.createElement("input",{type:"text",className:"form-control",id:"inputName3",ref:"name"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword3"},"Password"),React.createElement("input",{type:"text",className:"form-control",id:"inputPassword3",ref:"passwd"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"token"},"Token"),React.createElement("input",{type:"text",className:"form-control",id:"token",ref:"token"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"AK"},"AK"),React.createElement("input",{type:"text",className:"form-control",id:"AK",ref:"AK"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"SK"},"SK"),React.createElement("input",{type:"text",className:"form-control",id:"SK",ref:"SK"})),React.createElement("button",{type:"submit",className:"btn"},"Sign up")),React.createElement("br",null),React.createElement("textarea",{ref:"status"}))}});
"use strict";function Editor(e){____Classq.call(this,e),this.state={section:{id:"",title:"",content:""}}}function InputFile(e){____Classr.call(this,e),this.state={i:0}}var ____Classq=React.Component;for(var ____Classq____Key in ____Classq)____Classq.hasOwnProperty(____Classq____Key)&&(Editor[____Classq____Key]=____Classq[____Classq____Key]);var ____SuperProtoOf____Classq=null===____Classq?null:____Classq.prototype;Editor.prototype=Object.create(____SuperProtoOf____Classq),Editor.prototype.constructor=Editor,Editor.__superConstructor__=____Classq,Object.defineProperty(Editor.prototype,"tick",{writable:!0,configurable:!0,value:function(){var e=location.hash.slice(4);e?db.section.get(e,function(e){e&&(this.setState({section:e}),clearInterval(this.interval))}.bind(this)):clearInterval(this.interval)}}),Object.defineProperty(Editor.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){this.interval=setInterval(this.tick.bind(this),5)}}),Object.defineProperty(Editor.prototype,"componentWillUnmount",{writable:!0,configurable:!0,value:function(){clearInterval(this.interval)}}),Object.defineProperty(Editor.prototype,"handleTitleChange",{writable:!0,configurable:!0,value:function(e){var t=this.state.section;t.title=e.target.value,this.setState({section:t})}}),Object.defineProperty(Editor.prototype,"handleContentChange",{writable:!0,configurable:!0,value:function(e){var t=this.state.section;t.content=e.target.value,this.setState({section:t})}}),Object.defineProperty(Editor.prototype,"uploadFileSuccess",{writable:!0,configurable:!0,value:function(e,t){var n="\n!["+t.name+","+(t.size/1024).toFixed(2)+"KB,"+t.type+","+e+"]\n",a=document.getElementById("content");insertText(a,n);var r=this.state.section;r.content=a.value,this.setState({section:r})}}),Object.defineProperty(Editor.prototype,"uploadSetToServer",{writable:!0,configurable:!0,value:function(e){e.preventDefault(),this.props.uploadSetToServer(this.state.section)}}),Object.defineProperty(Editor.prototype,"render",{writable:!0,configurable:!0,value:function(){var e=this.state.section;return React.createElement("div",{className:"wrap"},React.createElement("form",{onSubmit:this.uploadSetToServer.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("input",{type:"text",className:"form-control",placeholder:"key",onChange:this.handleTitleChange.bind(this),value:e.title})),React.createElement("div",{className:"form-group"},React.createElement("textarea",{id:"content",className:"form-control",rows:"17",placeholder:"value",onChange:this.handleContentChange.bind(this),value:e.content})),React.createElement("button",{type:"submit",className:"btn insert right"},"Save")),React.createElement(InputFile,{uploadFolder:"u/",open:open,uploadFileSuccess:this.uploadFileSuccess.bind(this)}))}});var ____Classr=React.Component;for(var ____Classr____Key in ____Classr)____Classr.hasOwnProperty(____Classr____Key)&&(InputFile[____Classr____Key]=____Classr[____Classr____Key]);var ____SuperProtoOf____Classr=null===____Classr?null:____Classr.prototype;InputFile.prototype=Object.create(____SuperProtoOf____Classr),InputFile.prototype.constructor=InputFile,InputFile.__superConstructor__=____Classr,Object.defineProperty(InputFile.prototype,"handleClick",{writable:!0,configurable:!0,value:function(e){e.preventDefault();var t=document.getElementById("file"),n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),t.dispatchEvent(n)}}),Object.defineProperty(InputFile.prototype,"handleChange",{writable:!0,configurable:!0,value:function(){var e=document.getElementById("file").files,t=this.state.i;if(t<e.length){var n=t+1;this.setState({i:n}),document.getElementById("file-info").innerHTML=e[t].name,this.readAndUpload(e[t])}else document.getElementById("file").value="",document.getElementById("file-info").innerHTML="选择文件上传",this.setState({i:0})}}),Object.defineProperty(InputFile.prototype,"readAndUpload",{writable:!0,configurable:!0,value:function(e){var t=new FileReader;t.onload=function(n){var a=this.props.uploadFolder+timeDiff();upload({key:a,data:t.result,open:this.props.open,progress:document.getElementById("upload-progress"),success:function(){this.props.uploadFileSuccess(a,e),this.handleChange()}.bind(this)})}.bind(this),t.readAsArrayBuffer(e)}}),Object.defineProperty(InputFile.prototype,"render",{writable:!0,configurable:!0,value:function(){return React.createElement("div",{className:"attachment"},React.createElement("input",{id:"file",style:{display:"none"},type:"file",multiple:!0,onChange:this.handleChange.bind(this)}),React.createElement("a",{id:"file-info",className:"list-group-item",onClick:this.handleClick},"选择文件上传"),React.createElement("div",{id:"upload-progress",className:"list-group-item progress-bar"}))}});
"use strict";function Folder(e){____Classs.call(this,e),this.state={list:[],eraseKey:""}}function File(){null!==____Classt&&____Classt.apply(this,arguments)}var ____Classs=React.Component;for(var ____Classs____Key in ____Classs)____Classs.hasOwnProperty(____Classs____Key)&&(Folder[____Classs____Key]=____Classs[____Classs____Key]);var ____SuperProtoOf____Classs=null===____Classs?null:____Classs.prototype;Folder.prototype=Object.create(____SuperProtoOf____Classs),Folder.prototype.constructor=Folder,Folder.__superConstructor__=____Classs,Object.defineProperty(Folder.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){ajaxArrayBuffer({key:"folder/list",success:function(e){this.setState({list:e.list})}.bind(this)})}}),Object.defineProperty(Folder.prototype,"download",{writable:!0,configurable:!0,value:function(e){nDown(e.name,e.type,e.key,!1)}}),Object.defineProperty(Folder.prototype,"uploadFileSuccess",{writable:!0,configurable:!0,value:function(e,t){var s=(t.size/1024).toFixed(2)+"KB",a={key:e,name:t.name,type:t.type,size:s},r=this.state.list;r.push(a),this.updateList(r)}}),Object.defineProperty(Folder.prototype,"updateList",{writable:!0,configurable:!0,value:function(e){upload({key:"folder/list",data:strToUTF8Arr(JSON.stringify({list:e})),success:function(){this.setState({list:e})}.bind(this)})}}),Object.defineProperty(Folder.prototype,"toErase",{writable:!0,configurable:!0,value:function(e){this.setState({eraseKey:e})}}),Object.defineProperty(Folder.prototype,"componentWillReceiveProps",{writable:!0,configurable:!0,value:function(){if(this.props.erase){for(var e in this.state.list)this.state.list[e].key===this.state.eraseKey&&(this.state.list.splice(e,1),this.updateList(this.state.list),this.setState({eraseKey:""}));this.props.eraseEnd()}}}),Object.defineProperty(Folder.prototype,"render",{writable:!0,configurable:!0,value:function(){var e=this.state.list.slice(0).reverse();return React.createElement("div",{className:"wrap"},React.createElement(InputFile,{uploadFolder:"folder/",open:!1,uploadFileSuccess:this.uploadFileSuccess.bind(this)}),React.createElement("ul",{className:"list-group"},e.map(function(e){return React.createElement(File,{key:e.key,data:e,download:this.download.bind(this,e),toErase:this.toErase.bind(this)})}.bind(this))))}});var ____Classt=React.Component;for(var ____Classt____Key in ____Classt)____Classt.hasOwnProperty(____Classt____Key)&&(File[____Classt____Key]=____Classt[____Classt____Key]);var ____SuperProtoOf____Classt=null===____Classt?null:____Classt.prototype;File.prototype=Object.create(____SuperProtoOf____Classt),File.prototype.constructor=File,File.__superConstructor__=____Classt,Object.defineProperty(File.prototype,"dragStart",{writable:!0,configurable:!0,value:function(e){var t=e.target.dataset.key;e.dataTransfer.setData("key",t),this.props.toErase&&this.props.toErase(t)}}),Object.defineProperty(File.prototype,"render",{writable:!0,configurable:!0,value:function(){var e=this.props.data;return React.createElement("div",null,React.createElement("a",{className:"list-group-item","data-key":e.key,draggable:"true",onDragStart:this.dragStart.bind(this),onClick:this.props.download},React.createElement("i",{className:fileTypeIcons(e.type)+" fa-fw fa-lg"})," ",e.name,React.createElement("span",{className:"right"},e.size)),React.createElement("div",{id:e.key,className:"list-group-item progress-bar"}))}});
"use strict";function Tasks(t){____Class7.call(this,t),this.state={version:0,tasks:[],query:[],editID:""}}function Task(){null!==____Class8&&____Class8.apply(this,arguments)}var ____Class7=React.Component;for(var ____Class7____Key in ____Class7)____Class7.hasOwnProperty(____Class7____Key)&&(Tasks[____Class7____Key]=____Class7[____Class7____Key]);var ____SuperProtoOf____Class7=null===____Class7?null:____Class7.prototype;Tasks.prototype=Object.create(____SuperProtoOf____Class7),Tasks.prototype.constructor=Tasks,Tasks.__superConstructor__=____Class7,Object.defineProperty(Tasks.prototype,"loadTasks",{writable:!0,configurable:!0,value:function(){ajaxArrayBuffer({key:"tasks/"+this.state.version,success:function(t){this.setState({tasks:t.tasks}),this.setState({query:t.tasks})}.bind(this)})}}),Object.defineProperty(Tasks.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){ajaxArrayBuffer({key:"tasks/version",success:function(t){this.setState({version:t.version}),this.loadTasks()}.bind(this)})}}),Object.defineProperty(Tasks.prototype,"handleChange",{writable:!0,configurable:!0,value:function(t){var e=t.target.value,s=[],a=new RegExp(e,"i"),_=!0,r=!1,n=void 0;try{for(var i,o=this.state.tasks[Symbol.iterator]();!(_=(i=o.next()).done);_=!0){var l=i.value;null!==l.content.match(a)&&s.push(l)}}catch(c){r=!0,n=c}finally{try{!_&&o["return"]&&o["return"]()}finally{if(r)throw n}}this.setState({query:s})}}),Object.defineProperty(Tasks.prototype,"handleEdit",{writable:!0,configurable:!0,value:function(t){this.setState({editID:t.id}),this.refs.content.getDOMNode().value=t.content}}),Object.defineProperty(Tasks.prototype,"save",{writable:!0,configurable:!0,value:function(t){if(t.preventDefault(),""!==this.refs.content.getDOMNode().value){var e=this.state.version+1,s=this.state.tasks;if(""!==this.state.editID)for(var a in s)this.state.editID===s[a].id&&(s.splice(a,1),this.setState({editID:""}));var _={id:timeDiff(),content:this.refs.content.getDOMNode().value};s.push(_),upload({key:"tasks/"+e,data:strToUTF8Arr(JSON.stringify({tasks:s})),success:function(){upload({key:"tasks/version",data:strToUTF8Arr(JSON.stringify({version:e})),success:function(){this.setState({version:e}),this.setState({query:s}),this.refs.content.getDOMNode().value=""}.bind(this)})}.bind(this)})}}}),Object.defineProperty(Tasks.prototype,"render",{writable:!0,configurable:!0,value:function(){var t=this.state.query.slice(0).reverse();return React.createElement("div",{className:"wrap"},React.createElement("form",{onSubmit:this.save.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("input",{type:"text",className:"form-control",placeholder:"tasks",onChange:this.handleChange.bind(this),ref:"content"}))),t.map(function(t){return React.createElement(Task,{key:t.id,data:t,edit:this.handleEdit.bind(this,t)})}.bind(this)))}});var ____Class8=React.Component;for(var ____Class8____Key in ____Class8)____Class8.hasOwnProperty(____Class8____Key)&&(Task[____Class8____Key]=____Class8[____Class8____Key]);var ____SuperProtoOf____Class8=null===____Class8?null:____Class8.prototype;Task.prototype=Object.create(____SuperProtoOf____Class8),Task.prototype.constructor=Task,Task.__superConstructor__=____Class8,Object.defineProperty(Task.prototype,"render",{writable:!0,configurable:!0,value:function(){var t=this.props.data;return React.createElement("div",null,React.createElement("span",{className:"tasks"},t.content," ",React.createElement("a",{onClick:this.props.edit},React.createElement("i",{className:"fa fa-pencil"}))))}});
"use strict";function Root(t){____Class5.call(this,t),this.state={version:0,contents:[],set:[],auth:!1,url:location.hash,erase:!1}}var ____Class5=React.Component;for(var ____Class5____Key in ____Class5)____Class5.hasOwnProperty(____Class5____Key)&&(Root[____Class5____Key]=____Class5[____Class5____Key]);var ____SuperProtoOf____Class5=null===____Class5?null:____Class5.prototype;Root.prototype=Object.create(____SuperProtoOf____Class5),Root.prototype.constructor=Root,Root.__superConstructor__=____Class5,Object.defineProperty(Root.prototype,"loadSetFromServer",{writable:!0,configurable:!0,value:function(){ajaxArrayBuffer({key:"set/"+this.state.version,open:open,success:function(t){var e=[],o=!0,a=!1,s=void 0;try{for(var r,n=t.set[Symbol.iterator]();!(o=(r=n.next()).done);o=!0){var i=r.value,c={id:i.id,title:i.title,timestamp:i.timestamp};e.push(c)}}catch(l){a=!0,s=l}finally{try{!o&&n["return"]&&n["return"]()}finally{if(a)throw s}}this.setState({contents:e}),this.setState({set:t.set}),this.cacheToIndexedDB(),refresh=!0}.bind(this)})}}),Object.defineProperty(Root.prototype,"cacheToIndexedDB",{writable:!0,configurable:!0,value:function(){var t=this.state.version;db.etc.put({id:"version",version:t}),db.contents.put({id:t,arr:this.state.contents}),db.set.put({id:t,arr:this.state.set});var e=!0,o=!1,a=void 0;try{for(var s,r=this.state.set[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var n=s.value;db.section.put(n).then(function(){refresh=!0})}}catch(i){o=!0,a=i}finally{try{!e&&r["return"]&&r["return"]()}finally{if(o)throw a}}}}),Object.defineProperty(Root.prototype,"loadSetFromIndexedDB",{writable:!0,configurable:!0,value:function(){var t=this.state.version;db.contents.get(t,function(t){this.setState({contents:t.arr})}.bind(this)),db.set.get(t,function(t){this.setState({set:t.arr})}.bind(this))}}),Object.defineProperty(Root.prototype,"cache",{writable:!0,configurable:!0,value:function(){ajaxArrayBuffer({key:"version",open:open,success:function(t){this.setState({version:t.version}),db.etc.get("version",function(t){t&&t.version===this.state.version?(console.log("LoadSetFromIndexedDB"),this.loadSetFromIndexedDB()):(console.log("LoadSetFromServer"),this.loadSetFromServer())}.bind(this))}.bind(this)})}}),Object.defineProperty(Root.prototype,"handleUploadSetToServer",{writable:!0,configurable:!0,value:function(t){if(""!==t.title){var e=this.state.version+1,o=this.state.contents,a=this.state.set,s={id:t.id,title:t.title,timestamp:Date.now()};if(""===s.id)s.id=timeDiff(),o.push(s),s.content=t.content,a.push(s);else for(var r in o)s.id===o[r].id&&(o[r]=s,s.content=t.content,a[r]=s);this.setState({version:e}),this.setState({contents:o}),this.setState({set:a}),db.section.put(s),db.etc.put({id:"version",version:e}),db.contents.put({id:e,arr:o}),db.set.put({id:e,arr:a}),upload({key:"set/"+e,data:strToUTF8Arr(JSON.stringify({set:a})),open:open,success:function(){upload({key:"version",data:strToUTF8Arr(JSON.stringify({version:e})),open:open,success:function(){console.log("Save!!!"),location.href="#/t/"+s.id}})}})}}}),Object.defineProperty(Root.prototype,"handleErase",{writable:!0,configurable:!0,value:function(t){upload({key:t,data:strToUTF8Arr("x"),success:function(){console.log("Erase!!!"),this.setState({erase:!0}),this.setState({erase:!0})}.bind(this)})}}),Object.defineProperty(Root.prototype,"handleEraseEnd",{writable:!0,configurable:!0,value:function(){this.setState({erase:!1})}}),Object.defineProperty(Root.prototype,"handleLogin",{writable:!0,configurable:!0,value:function(){this.setState({auth:!0}),location.href="#/login"===local?"#/":local}}),Object.defineProperty(Root.prototype,"handleLogout",{writable:!0,configurable:!0,value:function(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.setState({auth:!1}),location.replace("#/")}}),Object.defineProperty(Root.prototype,"auth",{writable:!0,configurable:!0,value:function(){localStorage.token&&this.setState({auth:!0})}}),Object.defineProperty(Root.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){this.auth(),this.cache(),window.onhashchange=function(){return this.setState({url:location.hash})}.bind(this)}}),Object.defineProperty(Root.prototype,"render",{writable:!0,configurable:!0,value:function(){var t;switch(this.state.url.split("/")[1]){case"t":case"s":t=React.createElement(Section,React.__spread({},this.state));break;case"a":case"e":t=React.createElement(Editor,React.__spread({},this.state,{uploadSetToServer:this.handleUploadSetToServer.bind(this)}));break;case"login":t=React.createElement(SignIn,React.__spread({},this.state,{login:this.handleLogin.bind(this)}));break;case"join":t=React.createElement(SignUp,React.__spread({},this.state));break;case"folder":t=React.createElement(Folder,React.__spread({},this.state,{eraseEnd:this.handleEraseEnd.bind(this)}));break;case"tasks":t=React.createElement(Tasks,React.__spread({},this.state));break;default:t=React.createElement(Contents,React.__spread({},this.state))}return React.createElement("div",null,React.createElement(Navbar,{auth:this.state.auth,logout:this.handleLogout.bind(this),erase:this.handleErase.bind(this)}),t)}}),React.render(React.createElement(Root,null),document.getElementById("wrapper"));