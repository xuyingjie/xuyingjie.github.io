"use strict";function ajaxArrayBuffer(e){var t=new XMLHttpRequest;t.onload=function(){if(4===t.readyState&&(t.status>=200&&t.status<300||304===t.status)){var n=e.token?e.token:e.open?publicKey:localStorage.token,o=asmCrypto.AES_CBC.decrypt(t.response,n);if(console.log("AES.decrypt"),e.uint8Arr)e.success(o);else{var a=utf8ArrToStr(o);e.success(JSON.parse(a))}}},e.progress&&(t.onprogress=function(t){t.lengthComputable&&(e.progress.innerHTML=t.loaded===t.total?(t.total/1024).toFixed(2)+"KB":(t.loaded/t.total*100).toFixed(2)+"%")}),t.open("GET",url+e.key,!0),t.responseType="arraybuffer",t.send(null)}function upload(e){var t=e.token?e.token:e.open?publicKey:localStorage.token,n=asmCrypto.AES_CBC.encrypt(e.data,t);console.log("AES.encrypt");var o=new Blob([n.buffer],{type:"application/octet-stream"}),a=customForm(e,o),r=new XMLHttpRequest;e.progress&&(r.upload.onprogress=function(t){t.lengthComputable&&(e.progress.value=t.loaded/t.total*100)}),r.onload=function(){4===r.readyState&&(r.status>=200&&r.status<300||304==r.status)&&e.success()},r.open("POST",url,!0),r.send(a)}function customForm(e,t){var n=JSON.parse(localStorage.user),o=n.AK,a=n.SK,r={expiration:new Date(Date.now()+36e5).toJSON(),conditions:[{bucket:bucket},["eq","$key",e.key]]},s=btoa(JSON.stringify(r)),c=asmCrypto.HMAC_SHA1.base64(s,a),i=new FormData;return i.append("OSSAccessKeyId",o),i.append("policy",s),i.append("signature",c),null!==e.key.match("version")||"folder/list"===e.key?i.append("Cache-Control","no-cache"):i.append("Cache-Control","public,max-age=8640000"),i.append("key",e.key),i.append("file",t),i}function insertText(e,t){if(document.selection){var n=document.selection.createRange();n.text=t}else if("number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd){var o=e.selectionStart,a=e.selectionEnd,r=o,s=e.value;e.value=s.substring(0,o)+t+s.substring(a,s.length),r+=t.length,e.selectionStart=e.selectionEnd=r}else e.value+=t}function fileTypeIcons(e){switch(e){case"image/png":case"image/jpeg":case"image/vnd.microsoft.icon":return"fa fa-file-image-o";case"application/x-xz":case"application/gzip":case"application/zip":return"fa fa-file-archive-o";case"text/plain":case"text/x-markdown":return"fa fa-file-text-o";case"application/pdf":return"fa fa-file-pdf-o";case"application/msword":case"application/vnd.oasis.opendocument.text":return"fa fa-file-word-o";default:return"fa fa-file-o"}}function nDown(e,t,n,o){var a=document.getElementById(n);ajaxArrayBuffer({key:n,open:o,uint8Arr:!0,progress:a,success:function(n){var o=new Blob([n.buffer],{type:t}),r=URL.createObjectURL(o),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0),s.dispatchEvent(c),document.body.removeChild(s),a.value=0}})}function dragStart(e){e.dataTransfer.setData("key",e.target.dataset.key)}function timeDiff(){return Date.now()+""+Math.floor(9e3*Math.random()+1e3)}function utf8ArrToStr(e){for(var t,n="",o=e.length,a=0;o>a;a++)t=e[a],n+=String.fromCharCode(t>251&&254>t&&o>a+5?1073741824*(t-252)+(e[++a]-128<<24)+(e[++a]-128<<18)+(e[++a]-128<<12)+(e[++a]-128<<6)+e[++a]-128:t>247&&252>t&&o>a+4?(t-248<<24)+(e[++a]-128<<18)+(e[++a]-128<<12)+(e[++a]-128<<6)+e[++a]-128:t>239&&248>t&&o>a+3?(t-240<<18)+(e[++a]-128<<12)+(e[++a]-128<<6)+e[++a]-128:t>223&&240>t&&o>a+2?(t-224<<12)+(e[++a]-128<<6)+e[++a]-128:t>191&&224>t&&o>a+1?(t-192<<6)+e[++a]-128:t);return n}function strToUTF8Arr(e){for(var t,n,o=e.length,a=0,r=0;o>r;r++)n=e.charCodeAt(r),a+=128>n?1:2048>n?2:65536>n?3:2097152>n?4:67108864>n?5:6;t=new Uint8Array(a);for(var s=0,c=0;a>s;c++)n=e.charCodeAt(c),128>n?t[s++]=n:2048>n?(t[s++]=192+(n>>>6),t[s++]=128+(63&n)):65536>n?(t[s++]=224+(n>>>12),t[s++]=128+(n>>>6&63),t[s++]=128+(63&n)):2097152>n?(t[s++]=240+(n>>>18),t[s++]=128+(n>>>12&63),t[s++]=128+(n>>>6&63),t[s++]=128+(63&n)):67108864>n?(t[s++]=248+(n>>>24),t[s++]=128+(n>>>18&63),t[s++]=128+(n>>>12&63),t[s++]=128+(n>>>6&63),t[s++]=128+(63&n)):(t[s++]=252+(n>>>30),t[s++]=128+(n>>>24&63),t[s++]=128+(n>>>18&63),t[s++]=128+(n>>>12&63),t[s++]=128+(n>>>6&63),t[s++]=128+(63&n));return t}var siteTitle="Structure",bucket="structure",publicKey="GmPw2qjmTsAAUsqa",open=!0,url="http://"+bucket+".oss-cn-beijing.aliyuncs.com/",local="#/",refresh=!1,db=new Dexie(bucket);db.version(1).stores({etc:"id, version"}),db.version(1).stores({contents:"id, arr"}),db.version(1).stores({set:"id, arr"}),db.version(1).stores({section:"id, title, content, timestamp"}),db.open();
"use strict";function Navbar(){null!==____Class4E&&____Class4E.apply(this,arguments)}var ____Class4E=React.Component;for(var ____Class4E____Key in ____Class4E)____Class4E.hasOwnProperty(____Class4E____Key)&&(Navbar[____Class4E____Key]=____Class4E[____Class4E____Key]);var ____SuperProtoOf____Class4E=null===____Class4E?null:____Class4E.prototype;Navbar.prototype=Object.create(____SuperProtoOf____Class4E),Navbar.prototype.constructor=Navbar,Navbar.__superConstructor__=____Class4E,Navbar.prototype.handleIndexClick=function(a){a.preventDefault(),this.refs.mainput.getDOMNode().value="",location.href="#/"},Navbar.prototype.handleLogoutClick=function(a){a.preventDefault(),this.props.logout()},Navbar.prototype.handleLoginClick=function(a){a.preventDefault(),local=location.hash,location.href="#/login"},Navbar.prototype.handleMainputChange=function(a){a.preventDefault();var e=this.refs.mainput.getDOMNode().value;e.length>1?location.href="#/s/"+e:""===e&&(location.href="#/")},Navbar.prototype.preventDefault=function(a){a.preventDefault()},Navbar.prototype.drop=function(a){a.preventDefault();var e=a.dataTransfer.getData("key");""!==e&&this.props.erase(e)},Navbar.prototype.render=function(){var a;return a=this.props.auth?React.createElement("div",null,React.createElement("a",{className:"navbar-brand",href:"#/a"},React.createElement("span",{className:"fa fa-plus","aria-hidden":"true"})),React.createElement("a",{className:"navbar-brand",href:"#/tasks"},React.createElement("span",{className:"fa fa-tasks","aria-hidden":"true"})),React.createElement("a",{className:"navbar-brand",href:"#/folder"},React.createElement("span",{className:"fa fa-folder","aria-hidden":"true"})),React.createElement("div",{className:"navbar-brand",onDragOver:this.preventDefault,onDrop:this.drop.bind(this)},React.createElement("span",{className:"fa fa-trash","aria-hidden":"true"})),React.createElement("span",{className:"navbar-brand"}),React.createElement("a",{className:"navbar-brand",href:!0,onClick:this.handleLogoutClick.bind(this)},React.createElement("span",{className:"fa fa-sign-out","aria-hidden":"true"}))):React.createElement("div",null,React.createElement("a",{className:"navbar-brand",href:!0,onClick:this.handleLoginClick.bind(this)},React.createElement("span",{className:"fa fa-sign-in","aria-hidden":"true"}))),React.createElement("nav",{className:"navbar navbar-default navbar-fixed-top"},React.createElement("div",{className:"container-fluid"},React.createElement("a",{className:"navbar-brand custom-title",href:!0,onClick:this.handleIndexClick.bind(this)},siteTitle),React.createElement("form",{className:"navbar-form navbar-left",role:"search",onSubmit:this.handleMainputChange.bind(this)},React.createElement("input",{type:"text",className:"form-control mainput",ref:"mainput",onChange:this.handleMainputChange.bind(this)})),React.createElement("div",{className:"navbar-right"},a)))};
"use strict";function Contents(t){____Class1.call(this,t),this.state={contents:[]}}var ____Class1=React.Component;for(var ____Class1____Key in ____Class1)____Class1.hasOwnProperty(____Class1____Key)&&(Contents[____Class1____Key]=____Class1[____Class1____Key]);var ____SuperProtoOf____Class1=null===____Class1?null:____Class1.prototype;Contents.prototype=Object.create(____SuperProtoOf____Class1),Contents.prototype.constructor=Contents,Contents.__superConstructor__=____Class1,Contents.prototype.sort=function(){if(0===this.state.contents.length){var t=this.props.contents.slice(0);t.sort(this.props.auth?function(t,e){return e.timestamp-t.timestamp}:function(t,e){return t.title.localeCompare(e.title)}),this.setState({contents:t})}else clearInterval(this.interval)},Contents.prototype.componentDidMount=function(){this.interval=setInterval(this.sort.bind(this),5)},Contents.prototype.componentWillUnmount=function(){clearInterval(this.interval)},Contents.prototype.render=function(){return React.createElement("div",{className:"container-fluid"},this.state.contents.map(function(t){return React.createElement("a",{className:"btn btn-default",key:t.id,href:"#/t/"+t.id,role:"button"},t.title)}))};
"use strict";function Section(t){____Class4f.call(this,t),this.state={section:[],keyword:""}}function Fragment(){null!==____Class4g&&____Class4g.apply(this,arguments)}var ____Class4f=React.Component;for(var ____Class4f____Key in ____Class4f)____Class4f.hasOwnProperty(____Class4f____Key)&&(Section[____Class4f____Key]=____Class4f[____Class4f____Key]);var ____SuperProtoOf____Class4f=null===____Class4f?null:____Class4f.prototype;Section.prototype=Object.create(____SuperProtoOf____Class4f),Section.prototype.constructor=Section,Section.__superConstructor__=____Class4f,Section.prototype.loadIMG=function(t){ajaxArrayBuffer({key:t.dataset.key,open:open,uint8Arr:!0,success:function(e){var _=new Blob([e.buffer],{type:t.dataset.type}),n=URL.createObjectURL(_),r=document.createElement("img");r.src=n,r.dataset.key=t.dataset.key,r.ondragstart=dragStart,t.replaceChild(r,t.firstElementChild),t.setAttribute("name","dec-img")}})},Section.prototype.imgEvent=function(){for(var t=document.getElementsByName("enc-img"),e=0;e<t.length;e++){var _=t[e].getBoundingClientRect().top;_>0&&_<window.innerHeight&&this.loadIMG(t[e])}},Section.prototype.query=function(){var t={id:"",keyword:""};if("t"===location.hash.slice(2,3)?t.id=location.hash.slice(4):t.keyword=location.hash.slice(4),""!==t.id)refresh&&(console.log("Index"),db.section.get(t.id,function(t){t&&(this.setState({section:[t]}),refresh=!1,this.imgEvent(),window.onscroll=this.imgEvent.bind(this))}.bind(this)));else if(""!==t.keyword&&0!==this.props.set.length){var e=t.keyword;if(e!==this.state.keyword||refresh){console.log("Query");var _=[],n=new RegExp(e,"i"),r=!0,s=!1,a=void 0;try{for(var o,l=this.props.set[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var i=o.value;(null!==i.title.match(n)||null!==i.content.match(n))&&_.push(i)}}catch(c){s=!0,a=c}finally{try{!r&&l["return"]&&l["return"]()}finally{if(s)throw a}}this.setState({section:_}),this.setState({keyword:e}),refresh=!1,this.imgEvent(),window.onscroll=this.imgEvent.bind(this)}}},Section.prototype.componentDidMount=function(){refresh=!0,this.query(),this.interval=setInterval(this.query.bind(this),200)},Section.prototype.componentWillUnmount=function(){clearInterval(this.interval)},Section.prototype.render=function(){return React.createElement("div",null,this.state.section.map(function(t){return React.createElement(Fragment,{key:t.id,data:t,auth:this.props.auth})}.bind(this)))};var ____Class4g=React.Component;for(var ____Class4g____Key in ____Class4g)____Class4g.hasOwnProperty(____Class4g____Key)&&(Fragment[____Class4g____Key]=____Class4g[____Class4g____Key]);var ____SuperProtoOf____Class4g=null===____Class4g?null:____Class4g.prototype;Fragment.prototype=Object.create(____SuperProtoOf____Class4g),Fragment.prototype.constructor=Fragment,Fragment.__superConstructor__=____Class4g,Fragment.prototype.render=function(){var t=this.props.data,e=React.createElement("div",null);this.props.auth&&(e=React.createElement("a",{className:"label label-default",href:"#/e/"+t.id},"编辑"));var _=new Showdown.converter,n=_.makeHtml(t.content);return React.createElement("div",null,React.createElement("div",{className:"container-fluid"},React.createElement("h2",null,t.title),React.createElement("span",{dangerouslySetInnerHTML:{__html:n}}),e),React.createElement("hr",null))};
"use strict";function SignIn(){null!==____Class5&&____Class5.apply(this,arguments)}var ____Class5=React.Component;for(var ____Class5____Key in ____Class5)____Class5.hasOwnProperty(____Class5____Key)&&(SignIn[____Class5____Key]=____Class5[____Class5____Key]);var ____SuperProtoOf____Class5=null===____Class5?null:____Class5.prototype;SignIn.prototype=Object.create(____SuperProtoOf____Class5),SignIn.prototype.constructor=SignIn,SignIn.__superConstructor__=____Class5,SignIn.prototype.handleSubmit=function(e){e.preventDefault();var t=this.refs.name.getDOMNode().value,a=this.refs.passwd.getDOMNode().value;ajaxArrayBuffer({key:t,token:a,success:function(e){localStorage.token=e.user.token,localStorage.user=JSON.stringify(e.user),this.props.login(),this.refs.name.getDOMNode().value="",this.refs.passwd.getDOMNode().value=""}.bind(this)})},SignIn.prototype.render=function(){return React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-5"},React.createElement("form",{onSubmit:this.handleSubmit.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputName3"},"Name"),React.createElement("input",{type:"text",className:"form-control",id:"inputName3",ref:"name"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword3"},"Password"),React.createElement("input",{type:"password",className:"form-control",id:"inputPassword3",ref:"passwd"})),React.createElement("button",{type:"submit",className:"btn btn-default"},"Sign in")))))};
"use strict";function SignUp(){null!==____Class7&&____Class7.apply(this,arguments)}var ____Class7=React.Component;for(var ____Class7____Key in ____Class7)____Class7.hasOwnProperty(____Class7____Key)&&(SignUp[____Class7____Key]=____Class7[____Class7____Key]);var ____SuperProtoOf____Class7=null===____Class7?null:____Class7.prototype;SignUp.prototype=Object.create(____SuperProtoOf____Class7),SignUp.prototype.constructor=SignUp,SignUp.__superConstructor__=____Class7,SignUp.prototype.handleSubmit=function(e){e.preventDefault();var t=this.refs.name.getDOMNode().value,a=this.refs.passwd.getDOMNode().value,s=this.refs.token.getDOMNode().value,r=this.refs.AK.getDOMNode().value,l=this.refs.SK.getDOMNode().value,n={AK:r,SK:l,token:s};localStorage.token=s,localStorage.user=JSON.stringify(n),upload({key:t,data:strToUTF8Arr(JSON.stringify({user:n})),token:a,success:function(){console.log("Success!"),this.refs.status.getDOMNode().value="Success!"}.bind(this)})},SignUp.prototype.render=function(){return React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-5"},React.createElement("form",{onSubmit:this.handleSubmit.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputName3"},"Name"),React.createElement("input",{type:"text",className:"form-control",id:"inputName3",ref:"name"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword3"},"Password"),React.createElement("input",{type:"text",className:"form-control",id:"inputPassword3",ref:"passwd"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"token"},"Token"),React.createElement("input",{type:"text",className:"form-control",id:"token",ref:"token"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"AK"},"AK"),React.createElement("input",{type:"text",className:"form-control",id:"AK",ref:"AK"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"SK"},"SK"),React.createElement("input",{type:"text",className:"form-control",id:"SK",ref:"SK"})),React.createElement("button",{type:"submit",className:"btn btn-default"},"Sign up"))),React.createElement("div",{className:"col-sm-5"},React.createElement("textarea",{ref:"status"}))))};
"use strict";function Editor(t){____Class4q.call(this,t),this.state={section:{id:"",title:"",content:""}}}var ____Class4q=React.Component;for(var ____Class4q____Key in ____Class4q)____Class4q.hasOwnProperty(____Class4q____Key)&&(Editor[____Class4q____Key]=____Class4q[____Class4q____Key]);var ____SuperProtoOf____Class4q=null===____Class4q?null:____Class4q.prototype;Editor.prototype=Object.create(____SuperProtoOf____Class4q),Editor.prototype.constructor=Editor,Editor.__superConstructor__=____Class4q,Editor.prototype.tick=function(){var t=location.hash.slice(4);t?db.section.get(t,function(t){t&&(this.setState({section:t}),clearInterval(this.interval))}.bind(this)):clearInterval(this.interval)},Editor.prototype.componentDidMount=function(){this.interval=setInterval(this.tick.bind(this),5)},Editor.prototype.componentWillUnmount=function(){clearInterval(this.interval)},Editor.prototype.handleTitleChange=function(t){var e=this.state.section;e.title=t.target.value,this.setState({section:e})},Editor.prototype.handleContentChange=function(t){var e=this.state.section;e.content=t.target.value,this.setState({section:e})},Editor.prototype.readAndUpload=function(t){var e=new FileReader;e.onload=function(){var a="u/"+timeDiff(),n=document.getElementById("upload-progress");upload({key:a,data:e.result,open:open,progress:n,success:function(){var e="";e="image/png"===t.type||"image/jpeg"===t.type||"image/vnd.microsoft.icon"===t.type?'\n<span name="enc-img" data-name="'+t.name+'" data-type="'+t.type+'" data-key="'+a+'"><i class="fa fa-spinner fa-pulse fa-2x"></i></span>\n':'\n<a class="btn btn-default" data-key="'+a+'" draggable="true" ondragstart="dragStart(event)" onclick="nDown(\''+t.name+"','"+t.type+"','"+a+"',"+open+')">\n<i class="'+fileTypeIcons(t.type)+' fa-lg"></i>&nbsp;'+t.name+'&nbsp;<span id="'+a+'">'+(t.size/1024).toFixed(2)+"KB</span></a>\n";var o=document.getElementById("content");insertText(o,e);var i=this.state.section;i.content=o.value,this.setState({section:i}),document.getElementById("file").value="",n.value=0}.bind(this)})}.bind(this),e.readAsArrayBuffer(t)},Editor.prototype.uploadFile=function(t){t.preventDefault();for(var e=document.getElementById("file").files,a=0;a<e.length;a++)this.readAndUpload(e[a])},Editor.prototype.uploadSetToServer=function(t){t.preventDefault(),this.props.uploadSetToServer(this.state.section)},Editor.prototype.render=function(){var t=this.state.section;return React.createElement("div",{className:"container-fluid"},React.createElement("form",{onSubmit:this.uploadSetToServer.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("input",{type:"text",className:"form-control",placeholder:"key",onChange:this.handleTitleChange.bind(this),value:t.title})),React.createElement("div",{className:"form-group"},React.createElement("textarea",{id:"content",className:"form-control",rows:"17",placeholder:"value",onChange:this.handleContentChange.bind(this),value:t.content})),React.createElement("button",{type:"submit",className:"btn btn-default pull-right"},"Save")),React.createElement("form",{encType:"multipart/form-data",onSubmit:this.uploadFile.bind(this)},React.createElement("input",{id:"file",type:"file",required:!0,accept:!0,multiple:!0}),React.createElement("button",{type:"submit",className:"btn btn-default"},"Insert")),React.createElement("progress",{id:"upload-progress",min:"0",max:"100",value:"0"},"0"))};
"use strict";function Folder(e){____Class4C.call(this,e),this.state={list:[],eraseKey:""}}function File(){null!==____Class4D&&____Class4D.apply(this,arguments)}var ____Class4C=React.Component;for(var ____Class4C____Key in ____Class4C)____Class4C.hasOwnProperty(____Class4C____Key)&&(Folder[____Class4C____Key]=____Class4C[____Class4C____Key]);var ____SuperProtoOf____Class4C=null===____Class4C?null:____Class4C.prototype;Folder.prototype=Object.create(____SuperProtoOf____Class4C),Folder.prototype.constructor=Folder,Folder.__superConstructor__=____Class4C,Folder.prototype.componentDidMount=function(){ajaxArrayBuffer({key:"folder/list",success:function(e){this.setState({list:e.list})}.bind(this)})},Folder.prototype.download=function(e){nDown(e.name,e.type,e.key,!1)},Folder.prototype.uploadFile=function(e){e.preventDefault();for(var t=document.getElementById("file").files,s=0;s<t.length;s++)this.readAndUpload(t[s])},Folder.prototype.readAndUpload=function(e){var t=new FileReader;t.onload=function(){var s="folder/"+timeDiff();upload({key:s,data:t.result,progress:document.getElementById("upload-progress"),success:function(){var t={key:s,name:e.name,type:e.type,size:e.size},a=this.state.list;a.push(t),this.updateList(a)}.bind(this)})}.bind(this),t.readAsArrayBuffer(e)},Folder.prototype.updateList=function(e){upload({key:"folder/list",data:strToUTF8Arr(JSON.stringify({list:e})),success:function(){console.log("Upload!!!"),this.setState({list:e}),document.getElementById("file").value="",document.getElementById("upload-progress").value=0}.bind(this)})},Folder.prototype.dragStart=function(e){var t=e.target.dataset.key;e.dataTransfer.setData("key",t),this.setState({eraseKey:t})},Folder.prototype.componentWillReceiveProps=function(){if(this.props.erase){for(var e in this.state.list)this.state.list[e].key===this.state.eraseKey&&(this.state.list.splice(e,1),this.updateList(this.state.list),this.setState({eraseKey:""}));this.props.eraseEnd()}},Folder.prototype.render=function(){var e=this.state.list.slice(0).reverse();return React.createElement("div",{className:"container-fluid"},React.createElement("form",{encType:"multipart/form-data",onSubmit:this.uploadFile.bind(this)},React.createElement("input",{id:"file",type:"file",required:!0,accept:!0,multiple:!0}),React.createElement("button",{type:"submit",className:"btn btn-default"},"Insert")),React.createElement("progress",{id:"upload-progress",min:"0",max:"100",value:"0"},"0"),React.createElement("ul",{className:"list-group"},e.map(function(e){return React.createElement(File,{key:e.key,data:e,download:this.download.bind(this,e),dragStart:this.dragStart.bind(this)})}.bind(this))))};var ____Class4D=React.Component;for(var ____Class4D____Key in ____Class4D)____Class4D.hasOwnProperty(____Class4D____Key)&&(File[____Class4D____Key]=____Class4D[____Class4D____Key]);var ____SuperProtoOf____Class4D=null===____Class4D?null:____Class4D.prototype;File.prototype=Object.create(____SuperProtoOf____Class4D),File.prototype.constructor=File,File.__superConstructor__=____Class4D,File.prototype.render=function(){var e=this.props.data;return React.createElement("a",{className:"list-group-item",href:"#/folder","data-key":e.key,draggable:"true",onDragStart:this.props.dragStart,onClick:this.props.download},React.createElement("i",{className:fileTypeIcons(e.type)+" fa-fw fa-lg"})," ",e.name,React.createElement("span",{id:e.key,className:"pull-right"},(e.size/1024).toFixed(2)+"KB"))};
"use strict";function Tasks(t){____Class4s.call(this,t),this.state={version:0,tasks:[],query:[],editID:""}}function Task(){null!==____Class4t&&____Class4t.apply(this,arguments)}var ____Class4s=React.Component;for(var ____Class4s____Key in ____Class4s)____Class4s.hasOwnProperty(____Class4s____Key)&&(Tasks[____Class4s____Key]=____Class4s[____Class4s____Key]);var ____SuperProtoOf____Class4s=null===____Class4s?null:____Class4s.prototype;Tasks.prototype=Object.create(____SuperProtoOf____Class4s),Tasks.prototype.constructor=Tasks,Tasks.__superConstructor__=____Class4s,Tasks.prototype.loadTasks=function(){ajaxArrayBuffer({key:"tasks/"+this.state.version,success:function(t){this.setState({tasks:t.tasks}),this.setState({query:t.tasks})}.bind(this)})},Tasks.prototype.componentDidMount=function(){ajaxArrayBuffer({key:"tasks/version",success:function(t){this.setState({version:t.version}),this.loadTasks()}.bind(this)})},Tasks.prototype.handleChange=function(t){var s=t.target.value,e=[],a=new RegExp(s,"i"),_=!0,r=!1,n=void 0;try{for(var o,i=this.state.tasks[Symbol.iterator]();!(_=(o=i.next()).done);_=!0){var l=o.value;null!==l.content.match(a)&&e.push(l)}}catch(c){r=!0,n=c}finally{try{!_&&i["return"]&&i["return"]()}finally{if(r)throw n}}this.setState({query:e})},Tasks.prototype.handleEdit=function(t){this.setState({editID:t.id}),this.refs.content.getDOMNode().value=t.content},Tasks.prototype.save=function(t){if(t.preventDefault(),""!==this.refs.content.getDOMNode().value){var s=this.state.version+1,e=this.state.tasks;if(""!==this.state.editID)for(var a in e)this.state.editID===e[a].id&&(e.splice(a,1),this.setState({editID:""}));var _={id:timeDiff(),content:this.refs.content.getDOMNode().value};e.push(_),upload({key:"tasks/"+s,data:strToUTF8Arr(JSON.stringify({tasks:e})),success:function(){upload({key:"tasks/version",data:strToUTF8Arr(JSON.stringify({version:s})),success:function(){this.setState({version:s}),this.setState({query:e}),this.refs.content.getDOMNode().value=""}.bind(this)})}.bind(this)})}},Tasks.prototype.render=function(){var t=this.state.query.slice(0).reverse();return React.createElement("div",{className:"container-fluid"},React.createElement("form",{onSubmit:this.save.bind(this)},React.createElement("div",{className:"form-group"},React.createElement("input",{type:"text",className:"form-control tasks",placeholder:"tasks",onChange:this.handleChange.bind(this),ref:"content"}))),t.map(function(t){return React.createElement(Task,{key:t.id,data:t,edit:this.handleEdit.bind(this,t)})}.bind(this)))};var ____Class4t=React.Component;for(var ____Class4t____Key in ____Class4t)____Class4t.hasOwnProperty(____Class4t____Key)&&(Task[____Class4t____Key]=____Class4t[____Class4t____Key]);var ____SuperProtoOf____Class4t=null===____Class4t?null:____Class4t.prototype;Task.prototype=Object.create(____SuperProtoOf____Class4t),Task.prototype.constructor=Task,Task.__superConstructor__=____Class4t,Task.prototype.render=function(){var t=this.props.data;return React.createElement("div",{className:"tasks-margin"},React.createElement("span",{className:"tasks"},t.content," ",React.createElement("a",{href:"#/tasks",onClick:this.props.edit},React.createElement("i",{className:"fa fa-pencil"}))))};
"use strict";function Root(t){____Class4H.call(this,t),this.state={version:0,contents:[],set:[],auth:!1,url:location.hash,erase:!1}}var ____Class4H=React.Component;for(var ____Class4H____Key in ____Class4H)____Class4H.hasOwnProperty(____Class4H____Key)&&(Root[____Class4H____Key]=____Class4H[____Class4H____Key]);var ____SuperProtoOf____Class4H=null===____Class4H?null:____Class4H.prototype;Root.prototype=Object.create(____SuperProtoOf____Class4H),Root.prototype.constructor=Root,Root.__superConstructor__=____Class4H,Root.prototype.loadSetFromServer=function(){ajaxArrayBuffer({key:"set/"+this.state.version,open:open,success:function(t){var e=[],s=!0,o=!1,a=void 0;try{for(var n,r=t.set[Symbol.iterator]();!(s=(n=r.next()).done);s=!0){var i=n.value,c={id:i.id,title:i.title,timestamp:i.timestamp};e.push(c)}}catch(l){o=!0,a=l}finally{try{!s&&r["return"]&&r["return"]()}finally{if(o)throw a}}this.setState({contents:e}),this.setState({set:t.set}),this.cacheToIndexedDB(),refresh=!0}.bind(this)})},Root.prototype.cacheToIndexedDB=function(){var t=this.state.version;db.etc.put({id:"version",version:t}),db.contents.put({id:t,arr:this.state.contents}),db.set.put({id:t,arr:this.state.set});var e=!0,s=!1,o=void 0;try{for(var a,n=this.state.set[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value;db.section.put(r).then(function(){refresh=!0})}}catch(i){s=!0,o=i}finally{try{!e&&n["return"]&&n["return"]()}finally{if(s)throw o}}},Root.prototype.loadSetFromIndexedDB=function(){var t=this.state.version;db.contents.get(t,function(t){this.setState({contents:t.arr})}.bind(this)),db.set.get(t,function(t){this.setState({set:t.arr})}.bind(this))},Root.prototype.cache=function(){ajaxArrayBuffer({key:"version",open:open,success:function(t){this.setState({version:t.version}),db.etc.get("version",function(t){t&&t.version===this.state.version?(console.log("LoadSetFromIndexedDB"),this.loadSetFromIndexedDB()):(console.log("LoadSetFromServer"),this.loadSetFromServer())}.bind(this))}.bind(this)})},Root.prototype.handleUploadSetToServer=function(t){if(""!==t.title){var e=this.state.version+1,s=this.state.contents,o=this.state.set,a={id:t.id,title:t.title,timestamp:Date.now()};if(""===a.id)a.id=timeDiff(),s.push(a),a.content=t.content,o.push(a);else for(var n in s)a.id===s[n].id&&(s[n]=a,a.content=t.content,o[n]=a);this.setState({version:e}),this.setState({contents:s}),this.setState({set:o}),db.section.put(a),db.etc.put({id:"version",version:e}),db.contents.put({id:e,arr:s}),db.set.put({id:e,arr:o}),upload({key:"set/"+e,data:strToUTF8Arr(JSON.stringify({set:o})),open:open,success:function(){upload({key:"version",data:strToUTF8Arr(JSON.stringify({version:e})),open:open,success:function(){console.log("Save!!!"),location.href="#/t/"+a.id}})}})}},Root.prototype.handleErase=function(t){upload({key:t,data:strToUTF8Arr("x"),success:function(){console.log("Erase!!!"),this.setState({erase:!0}),this.setState({erase:!0})}.bind(this)})},Root.prototype.handleEraseEnd=function(){this.setState({erase:!1})},Root.prototype.handleLogin=function(){this.setState({auth:!0}),open||this.cache(),location.href=local},Root.prototype.handleLogout=function(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.setState({auth:!1}),open?location.replace("#/"):(db["delete"](),this.setState({version:0}),this.setState({contents:[]}),this.setState({set:[]}),location.replace("#/login"))},Root.prototype.auth=function(){localStorage.token?(this.setState({auth:!0}),this.cache()):open?this.cache():location.href="#/login"},Root.prototype.componentDidMount=function(){this.auth(),window.onhashchange=function(){return this.setState({url:location.hash})}.bind(this)},Root.prototype.render=function(){var t;switch(this.state.url.split("/")[1]){case"t":case"s":t=React.createElement(Section,React.__spread({},this.state));break;case"a":case"e":t=React.createElement(Editor,React.__spread({},this.state,{uploadSetToServer:this.handleUploadSetToServer.bind(this)}));break;case"login":t=React.createElement(SignIn,React.__spread({},this.state,{login:this.handleLogin.bind(this)}));break;case"join":t=React.createElement(SignUp,React.__spread({},this.state));break;case"folder":t=React.createElement(Folder,React.__spread({},this.state,{eraseEnd:this.handleEraseEnd.bind(this)}));break;case"tasks":t=React.createElement(Tasks,React.__spread({},this.state));break;default:t=React.createElement(Contents,React.__spread({},this.state))}return React.createElement("div",null,React.createElement(Navbar,{auth:this.state.auth,logout:this.handleLogout.bind(this),erase:this.handleErase.bind(this)}),t)},React.render(React.createElement(Root,null),document.body);